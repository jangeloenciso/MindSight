{% extends "components/base.html" %} {% block title %} Mindsight - Dashboard{%
endblock %} {% block styles %}
<link rel="stylesheet" href="/static/css/dashboard.css" />
<style>
  /* Add CSS styles for the loading spinner */
  .spinner {
    display: block;
    width: 80px;
    aspect-ratio: 1/1;
    position: absolute;
    left: 0;
    top: 0;
    user-select: none;
    pointer-events: none;
    transform: translate(33vw, 30vh);
  }
</style>
{% endblock %} {% block content %}
<div class="right">
  <!-- <div class="title-date">
      <span>
        Dashboard
      </span>
      <span class="date">
        3/29/24 1:56 PM
      </span>
    </div> -->
  <div class="column1">
    <div class="experience-container">
      <div class="total-cases-container">
        <span class="title-total-cases" id="experiences">
          <div>Experiences</div>
        </span>
      </div>
      <div id="history_container"></div>
    </div>
  </div>
  <div class="column2">
    <div class="row1">
      <div class="total-cases">
        <div class="total-cases-container">
          <div class="total-cases-number">
            <span class="title-total-cases">
              <div>Total Cases:&nbsp;</div>
            </span>
            <span class="title-total-cases" id="total-cases"></span>
          </div>
          <div class="back-button">
            <a href="{{ url_for('cases') }}">
              <img src="/static/SVG/back_button.svg" />
            </a>
          </div>
        </div>
        <canvas id="myChart1" height="120"></canvas>
      </div>
      <div class="terminated-cases">
        <div class="total-cases-container">
          <span class="title-total-cases" id="terminated">
            <div>Terminated</div>
          </span>
        </div>
        <span>Junior High</span>
        <div id="jhs_container"></div>

        <span>Senior High</span>
        <div id="shs_container"></div>

        <span>College</span>
        <div id="college_container"></div>

        <span>Graduate</span>
        <div id="grad_container"></div>

        <span>Lifelong Learners</span>
        <div id="lll_container"></div>
      </div>
    </div>
    <div class="row2">
      <div class="bottom-container">
        <div class="container">
          <span id="title">
            <div>Campus</div>
          </span>
          <div class="content">
            <div class="box">
              <div id="campus_container"></div>
            </div>
          </div>
        </div>
        <div class="vl"></div>
        <div class="container">
          <span id="title">
            <div>Concern</div>
          </span>
          <div class="content">
            <div class="box">
              <div id="concerns_container"></div>
            </div>
          </div>
        </div>
        <div class="vl"></div>
        <div class="container">
          <span id="title">
            <div>Identity</div>
          </span>
          <div class="content">
            <div class="box">
              <div id="identity_container"></div>
            </div>
          </div>
        </div>
        <div class="vl"></div>
        <div class="container">
          <span id="title">
            <div>Religion</div>
          </span>
          <div class="content">
            <div class="box">
              <div id="religion_container"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="{{ url_for('static', filename='javascript/cdn/chartjs.js') }}"></script>
<script src="{{ url_for('static', filename='javascript/dashboard.js') }}"></script>

<script>
  const jhs_data = {{ jhs_data | tojson | safe }};
  const shs_data = {{ shs_data | tojson | safe }};
  const college_data = {{ college_data | tojson | safe }};
  const grad_data = {{ grad_data | tojson | safe }};
  const lll_data = {{ lll_data | tojson | safe }};
  const identity_data = {{ identity_data | tojson | safe }};
  const campus_data = {{ campus_data | tojson | safe }};
  const religion_data = {{ religion_data | tojson | safe }};
  const history_data = {{ history_data | tojson | safe }};
  const concerns_data = {{ concerns_data | tojson | safe }};
  const terminated_data = {{ terminated_data | tojson | safe }};
  const overall_monthly_total = {{ overall_monthly_total | tojson | safe }};

  function renderChart(data, container) {
    const chartContainer = document.getElementById(container);
    chartContainer.innerHTML = '';

    let sortedData;
    if (data === overall_monthly_total) {
        // Convert month names to numerical representation for sorting
        const monthNames = {
            January: 1,
            February: 2,
            March: 3,
            April: 4,
            May: 5,
            June: 6,
            July: 7,
            August: 8,
            September: 9,
            October: 10,
            November: 11,
            December: 12
        };

        sortedData = Object.entries(data).sort((a, b) => {
            return monthNames[a[0]] - monthNames[b[0]];
        });
    } else {
        sortedData = Object.entries(data).sort((a, b) => b[1] - a[1]);
    }

    sortedData.forEach(([label, count]) => {
        const progressBar = createProgressBar(label, count);
        chartContainer.appendChild(progressBar);
    });
  }

  function renderTotal(data) {
    let overallTotal = 0;
    for (const monthTotal of Object.values(data)) {
        overallTotal += monthTotal;
    }
    document.getElementById('total-cases').textContent = overallTotal;
    console.log(overallTotal);
  }

  function createProgressBar(label, count) {
    const container = document.createElement('div');
    container.classList.add('progress-bar-container');

    const labelElement = document.createElement('div');
    labelElement.classList.add('progress-bar-label');
    labelElement.textContent = label;
    container.appendChild(labelElement);

    const progressFlexContainer = document.createElement('div');
    progressFlexContainer.classList.add('progress-flex-container');

    const countElement = document.createElement('div');
    countElement.classList.add('progress-bar-count');
    countElement.textContent = count;
    progressFlexContainer.appendChild(countElement);

    container.appendChild(progressFlexContainer);

    return container;
  }
    renderTotal(overall_monthly_total);
    renderChart(jhs_data, 'jhs_container');
    renderChart(shs_data, 'shs_container');
    renderChart(college_data, 'college_container');
    renderChart(grad_data, 'grad_container');
    renderChart(lll_data, 'lll_container');
    renderChart(history_data, 'history_container');
    renderChart(concerns_data, 'concerns_container');
    renderChart(identity_data, 'identity_container');
    renderChart(campus_data, 'campus_container');
    renderChart(religion_data, 'religion_container');
</script>

{% endblock %}
